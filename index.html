<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>DOOM PezzaliAPP Edition — PWA</title>
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#0a0f1f" />
  <link rel="icon" href="./icons/icon-192.png" />
  <link rel="stylesheet" href="./ui.css" />
  <style>
    :root { color-scheme: dark; }
    body{margin:0;background:#0a0f1f;color:#eaf0ff;font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    main.wrap{max-width:980px;margin:0 auto;padding:12px}
    #screen{display:block;margin:16px auto;background:#000;max-width:100%;height:auto;image-rendering:pixelated}
    .panel{background:#0f1729;border:1px solid #1f2a44;border-radius:12px;padding:12px}
    .row{display:flex;gap:.5rem;flex-wrap:wrap}
    .banner{margin-top:.5rem;padding:.5rem .75rem;border-radius:8px}
    .warn{background:#14223a;color:#dbeafe}
    .touch{position:fixed;inset:0;pointer-events:none}
    .stick{position:absolute;left:20px;bottom:20px;width:120px;height:120px;border-radius:50%;background:#0f1729aa;border:1px solid #1f2a44}
    .stick .nub{position:absolute;left:50%;top:50%;width:56px;height:56px;border-radius:50%;background:#24324faa;border:1px solid #41557a;transform:translate(-50%,-50%)}
    .buttons{position:absolute;right:20px;bottom:20px;display:flex;gap:12px}
    .buttons .btn{pointer-events:auto;width:64px;height:64px;border-radius:50%;border:1px solid #41557a;background:#24324faa;color:#eaf0ff;font:600 18px/64px system-ui;text-align:center}
    .buttons .btn.small{width:48px;height:48px;line-height:48px}
  </style>
</head>
<body>
  <header class="bar" style="padding:12px 16px;display:flex;gap:12px;align-items:center">
    <h1 style="margin:0;font-weight:700;font-size:18px">DOOM PezzaliAPP Edition</h1>
    <button id="btnInstall" hidden>Installa</button>
  </header>

  <main class="wrap">
    <canvas id="screen" width="640" height="480" tabindex="0" aria-label="Schermo di gioco"></canvas>

    <section class="panel">
      <div class="row">
        <input type="file" id="wadInput" accept=".wad,.WAD" />
        <button id="btnFreedoomLocal" type="button">Usa Freedoom locale</button>
        <button id="loadShareware" type="button">Usa WAD shareware (mirror)</button>
        <button id="btnStart" type="button" disabled>Avvia</button>
      </div>

      <p class="muted" style="opacity:.85;margin:.5rem 0 0">
        Carica <strong>doom1.wad</strong> (shareware), un IWAD legale (DOOM/DOOM II) o
        <strong>Freedoom</strong>. I dati restano sul tuo device (OPFS/IndexedDB) per l’uso offline.
      </p>

      <div id="banner" class="banner warn" hidden></div>

      <details style="margin-top:.5rem">
        <summary>Controlli</summary>
        <ul>
          <li>WASD/↑↓←→ per muoversi</li>
          <li>Spazio: usa/apri · Ctrl: fuoco · Esc: menu</li>
          <li>Mobile: overlay touch + Gamepad (se disponibile)</li>
        </ul>
      </details>
    </section>
  </main>

  <div class="touch" id="touchUI" aria-hidden="true">
    <div class="stick" id="stickL" data-type="move">
      <div class="nub"></div>
    </div>
    <div class="buttons">
      <button class="btn" data-key="ControlLeft" aria-label="Fuoco">A</button>
      <button class="btn" data-key="Space" aria-label="Usa/Apri">B</button>
      <button class="btn small" data-key="Escape" aria-label="Menu">▦</button>
    </div>
  </div>

  <script src="./wasm-glue.js"></script>
  <script src="./app.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(console.error);
    }
  </script>
</body>
</html>
